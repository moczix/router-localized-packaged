!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/router"),require("rxjs"),require("rxjs/operators"),require("@ngx-translate/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("localize-router",["exports","@angular/core","@angular/router","rxjs","rxjs/operators","@ngx-translate/core","@angular/common"],e):e((t=t||self)["localize-router"]={},t.ng.core,t.ng.router,t.rxjs,t.rxjs.operators,t.core$1,t.ng.common)}(this,function(t,e,r,n,o,a,i){"use strict";var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function u(t,e){function r(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var c=function(){return(c=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function l(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function h(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(l(arguments[e]));return t}var p=new e.InjectionToken("LOCALIZE_ROUTER_FORROOT_GUARD"),f=new e.InjectionToken("RAW_ROUTES"),d={LocalStorage:"LocalStorage",Cookie:"Cookie"},g=new e.InjectionToken("USE_CACHED_LANG"),y=new e.InjectionToken("CACHE_MECHANISM"),v=new e.InjectionToken("CACHE_NAME"),L=new e.InjectionToken("DEFAULT_LANG_FUNCTION"),R=new e.InjectionToken("ALWAYS_SET_PREFIX");var _="LOCALIZE_DEFAULT_LANGUAGE",m=function(){function t(t,e,r,n,o){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===r&&(r=d.LocalStorage),void 0===n&&(n=_),void 0===o&&(o=void 0),this.useCachedLang=t,this.alwaysSetPrefix=e,this.cacheMechanism=r,this.cacheName=n,this.defaultLangFunction=o}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:Boolean,decorators:[{type:e.Inject,args:[g]}]},{type:Boolean,decorators:[{type:e.Inject,args:[R]}]},{type:void 0,decorators:[{type:e.Inject,args:[y]}]},{type:String,decorators:[{type:e.Inject,args:[v]}]},{type:void 0,decorators:[{type:e.Inject,args:[L]}]}]},t}();var C=function(){function t(t,e,r){this.translate=t,this.location=e,this.settings=r}return t.prototype.init=function(t){var e;if(this.routes=t,!this.locales||!this.locales.length)return Promise.resolve();var r=this.getLocationLang(),n=this._getBrowserLang();this.settings.defaultLangFunction?this.defaultLang=this.settings.defaultLangFunction(this.locales,this._cachedLang,n):this.defaultLang=this._cachedLang||n||this.locales[0];var o=r||this.defaultLang;this.translate.setDefaultLang(this.defaultLang);var a=[];if(this.settings.alwaysSetPrefix){var i={path:"",redirectTo:this.defaultLang,pathMatch:"full"},s=t.findIndex(function(t){return"**"===t.path});-1!==s&&(this._wildcardRoute=t.splice(s,1)[0]),a=this.routes.splice(0,this.routes.length,i)}else a=this.routes.splice(0,this.routes.length);for(var u=a.length-1;u>=0;u--)a[u].data&&a[u].data.skipRouteLocalization&&(this.routes.push(a[u]),a.splice(u,1));return a&&a.length&&(this.locales.length>1||this.settings.alwaysSetPrefix?(this._languageRoute={children:a},this.routes.unshift(this._languageRoute)):(e=this.routes).unshift.apply(e,h(a))),this._wildcardRoute&&this.settings.alwaysSetPrefix&&this.routes.push(this._wildcardRoute),this.translateRoutes(o).toPromise()},t.prototype.initChildRoutes=function(t){return this._translateRouteTree(t),t},t.prototype.mutateRouterRootRoute=function(t,e,r){var n=this.settings.alwaysSetPrefix||e!==this.defaultLang?e:"",o=this.settings.alwaysSetPrefix||t!==this.defaultLang?t:"",a=r.find(function(t){return t.path===n});a&&(a.path=o)},t.prototype.translateRoutes=function(t){var e=this;return this.setRootLanguage(t),this.translate.use(t).pipe(o.map(function(r){e._translationObject=r,e.currentLang=t,e._languageRoute?(e._translateRouteTree(e._languageRoute.children),e._wildcardRoute&&e._wildcardRoute.redirectTo&&e._translateProperty(e._wildcardRoute,"redirectTo",!0)):e._translateRouteTree(e.routes)}))},t.prototype.setRootLanguage=function(t){this._cachedLang=t,this._languageRoute&&(this._languageRoute.path=this.settings.alwaysSetPrefix||t!==this.defaultLang?t:"")},t.prototype._translateRouteTree=function(t){var e=this;t.forEach(function(t){t.path&&"**"!==t.path&&e._translateProperty(t,"path"),t.redirectTo&&e._translateProperty(t,"redirectTo",!t.redirectTo.indexOf("/")),t.children&&e._translateRouteTree(t.children),t.loadChildren&&t._loadedConfig&&e._translateRouteTree(t._loadedConfig.routes)})},t.prototype._translateProperty=function(t,e,r){var n=t.data=t.data||{};n.localizeRouter||(n.localizeRouter={}),n.localizeRouter[e]||(n.localizeRouter[e]=t[e]);var o=this.translateRoute(n.localizeRouter[e]);t[e]=r?"/"+this.urlPrefix+o:o},Object.defineProperty(t.prototype,"urlPrefix",{get:function(){return this.settings.alwaysSetPrefix||this.currentLang!==this.defaultLang?this.currentLang:""},enumerable:!0,configurable:!0}),t.prototype.translateRoute=function(t){var e=this,r=t.split("?");if(r.length>2)throw"There should be only one query parameter block in the URL";return r[0].split("/").map(function(t){return t.length?e.translateText(t):t}).join("/")+(r.length>1?"?"+r[1]:"")},t.prototype.getLocationLang=function(t){var e=(t||this.location.path()||"").split("#")[0].split("?")[0].split("/");return e.length>1&&-1!==this.locales.indexOf(e[1])?e[1]:e.length&&-1!==this.locales.indexOf(e[0])?e[0]:null},t.prototype._getBrowserLang=function(){return this._returnIfInLocales(this.translate.getBrowserLang())},Object.defineProperty(t.prototype,"_cachedLang",{get:function(){if(this.settings.useCachedLang)return this.settings.cacheMechanism===d.LocalStorage?this._cacheWithLocalStorage():this.settings.cacheMechanism===d.Cookie?this._cacheWithCookies():void 0},set:function(t){this.settings.useCachedLang&&(this.settings.cacheMechanism===d.LocalStorage&&this._cacheWithLocalStorage(t),this.settings.cacheMechanism===d.Cookie&&this._cacheWithCookies(t))},enumerable:!0,configurable:!0}),t.prototype._cacheWithLocalStorage=function(t){if("undefined"!=typeof window&&void 0!==window.localStorage)try{return t?void window.localStorage.setItem(this.settings.cacheName,t):this._returnIfInLocales(window.localStorage.getItem(this.settings.cacheName))}catch(t){return}},t.prototype._cacheWithCookies=function(t){if("undefined"!=typeof document&&void 0!==document.cookie)try{var e=encodeURIComponent(this.settings.cacheName);if(t){var r=new Date;return r.setTime(r.getTime()+2592e6),void(document.cookie=e+"="+encodeURIComponent(t)+";expires="+r.toUTCString())}var n=new RegExp("(?:^"+e+"|;\\s*"+e+")=(.*?)(?:;|$)","g").exec(document.cookie);return decodeURIComponent(n[1])}catch(t){return}},t.prototype._returnIfInLocales=function(t){return t&&-1!==this.locales.indexOf(t)?t:null},t.prototype.translateText=function(t){if(!this._translationObject)return t;var e=this.prefix+t,r=this.translate.getParsedResult(this._translationObject,e);return r===e?t:r||t},t.ctorParameters=function(){return[{type:a.TranslateService,decorators:[{type:e.Inject,args:[a.TranslateService]}]},{type:i.Location,decorators:[{type:e.Inject,args:[i.Location]}]},{type:m,decorators:[{type:e.Inject,args:[m]}]}]},t}();var I=function(t){function e(e,r,n,o,a){void 0===o&&(o=["en"]),void 0===a&&(a="ROUTES.");var i=t.call(this,e,r,n)||this;return i.locales=o,i.prefix=a||"",i}return u(e,t),e.prototype.load=function(t){var e=this;return new Promise(function(r){e.init(t).then(r)})},e}(C),S=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.load=function(t){var e=this;return new Promise(function(r){e.init(t).then(r)})},e}(C),w=function(){function t(t,e,r){this.parser=t,this.settings=e,this.router=r,this.routerEvents=new n.Subject}return t.prototype.init=function(){this.router.resetConfig(this.parser.routes),this.router.events.pipe(o.filter(function(t){return t instanceof r.NavigationStart}),o.pairwise()).subscribe(this._routeChanged())},t.prototype.changeLanguage=function(t){var e=this;if(t!==this.parser.currentLang){var r=this.router.routerState.snapshot.root;this.parser.translateRoutes(t).pipe(o.tap(function(){return e.router.resetConfig(e.parser.routes)})).subscribe(function(){var t=e.traverseSnapshot(r,!0).filter(function(t,e){return!e||t}),n=c({},r.queryParamMap.keys.length?{queryParams:r.queryParams}:{},r.fragment?{fragment:r.fragment}:{});e.router.navigate(t,n)})}},t.prototype.traverseSnapshot=function(t,e){var n=this;if(void 0===e&&(e=!1),e)return t.firstChild?this.settings.alwaysSetPrefix||this.parser.currentLang!==this.parser.defaultLang?h(["/"+this.parser.currentLang],this.traverseSnapshot(t.firstChild.firstChild)):h(this.traverseSnapshot(t.firstChild.firstChild)):[""];var o=this.parseSegmentValue(t),a=t.children.filter(function(t){return t.outlet!==r.PRIMARY_OUTLET}),i=a.reduce(function(t,e){var r;return{outlets:c({},t.outlets,(r={},r[e.outlet]=n.parseSegmentValue(e),r))}},{outlets:{}}),s=t.children.find(function(t){return t.outlet===r.PRIMARY_OUTLET});return h([o],Object.keys(t.params).length?[t.params]:[],a.length?[i]:[],s?this.traverseSnapshot(s):[])},t.prototype.parseSegmentValue=function(t){var e=this;if(t.routeConfig){if("**"===t.routeConfig.path)return this.parser.translateRoute(t.url.filter(function(t){return t.path}).map(function(t){return t.path}).join("/"));if(t.routeConfig.data)return t.routeConfig.data.localizeRouter.path.split("/").map(function(r,n){return 0===r.indexOf(":")?t.url[n].path:e.parser.translateRoute(r)}).join("/")}return""},t.prototype.translateRoute=function(t){var e=this;if(!t)return t;if("string"==typeof t){var r=this.parser.translateRoute(t);return t.indexOf("/")?r:"/"+this.parser.urlPrefix+r}var n=[];return t.forEach(function(t,r){if("string"==typeof t){var o=e.parser.translateRoute(t);r||t.indexOf("/")?n.push(o):n.push("/"+e.parser.urlPrefix+o)}else if(t&&t.outlets){var a={};for(var i in t.outlets)t.outlets.hasOwnProperty(i)&&(a[i]=e.translateRoute(t.outlets[i]));n.push(c({},t,{outlets:a}))}else n.push(t)}),n},t.prototype._routeChanged=function(){var t=this;return function(e){var r=l(e,2),n=r[0],a=r[1],i=t.parser.getLocationLang(n.url)||t.parser.defaultLang,s=t.parser.getLocationLang(a.url)||t.parser.defaultLang;s!==i&&(t.parser.mutateRouterRootRoute(s,i,t.router.config),t.parser.translateRoutes(s).pipe(o.tap(function(){return t.router.resetConfig(t.parser.routes)})).subscribe(function(){t.routerEvents.next(s)}))}},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:C,decorators:[{type:e.Inject,args:[C]}]},{type:m,decorators:[{type:e.Inject,args:[m]}]},{type:r.Router,decorators:[{type:e.Inject,args:[r.Router]}]}]},t}();function j(t,e){if(t===e)return!0;if(null===t||null===e)return!1;if(t!=t&&e!=e)return!0;var r,n,o,a=typeof t;if(a===typeof e&&"object"===a){if(!Array.isArray(t)){if(Array.isArray(e))return!1;for(n in o=Object.create(null),t)if(t.hasOwnProperty(n)){if(!j(t[n],e[n]))return!1;o[n]=!0}for(n in e)if(e.hasOwnProperty(n)&&!(n in o)&&void 0!==e[n])return!1;return!0}if(!Array.isArray(e))return!1;if((r=t.length)===e.length){for(n=0;n<r;n++)if(!j(t[n],e[n]))return!1;return!0}}return!1}var P=function(){function t(t,e){var r=this;this.localize=t,this._ref=e,this.value="",this.subscription=this.localize.routerEvents.subscribe(function(){r.transform(r.lastKey)})}return t.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},t.prototype.transform=function(t){return t&&0!==t.length&&this.localize.parser.currentLang?j(t,this.lastKey)&&j(this.lastLanguage,this.localize.parser.currentLang)?this.value:(this.lastKey=t,this.lastLanguage=this.localize.parser.currentLang,this.value=this.localize.translateRoute(t),this.lastKey=t,128&this._ref._view.state?this.value:(this._ref.detectChanges(),this.value)):t},t.decorators=[{type:e.Pipe,args:[{name:"localize",pure:!1}]}],t.ctorParameters=function(){return[{type:w},{type:e.ChangeDetectorRef}]},t}();var T=function(t){function n(e,r,n){var o=t.call(this,r,n)||this;return o.localize=e,o}return u(n,t),n.prototype.load=function(e){var n=this;return t.prototype.load.call(this,e).then(function(t){return{moduleType:t.moduleType,create:function(e){var o=t.create(e),a=o.injector.get.bind(o.injector);return o.injector.get=function(t,e){var o=a(t,e);return t===r.ROUTES?n.localize.initChildRoutes([].concat.apply([],h(o))):o},o}}})},n.decorators=[{type:e.Injectable}],n.ctorParameters=function(){return[{type:C,decorators:[{type:e.Inject,args:[e.forwardRef(function(){return C})]}]},{type:e.Compiler},{type:e.SystemJsNgModuleLoaderConfig,decorators:[{type:e.Optional}]}]},n}(e.SystemJsNgModuleLoader);var O=function(){function t(t){this.injector=t}return t.prototype.appInitializer=function(){var t=this,e=this.parser.load(this.routes);return e.then(function(){t.injector.get(w).init()}),e},t.prototype.generateInitializer=function(t,e){return this.parser=t,this.routes=e.reduce(function(t,e){return t.concat(e)}),this.appInitializer},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:e.Injector}]},t}();function x(t,e,r){return t.generateInitializer(e,r).bind(t)}var b=function(){function t(){}return t.forRoot=function(r,n){return void 0===n&&(n={}),{ngModule:t,providers:[{provide:p,useFactory:A,deps:[[t,new e.Optional,new e.SkipSelf]]},{provide:g,useValue:n.useCachedLang},{provide:R,useValue:n.alwaysSetPrefix},{provide:v,useValue:n.cacheName},{provide:y,useValue:n.cacheMechanism},{provide:L,useValue:n.defaultLangFunction},m,n.parser||{provide:C,useClass:S},{provide:f,multi:!0,useValue:r},w,O,{provide:e.NgModuleFactoryLoader,useClass:T},{provide:e.APP_INITIALIZER,multi:!0,useFactory:x,deps:[O,C,f]}]}},t.forChild=function(e){return{ngModule:t,providers:[{provide:f,multi:!0,useValue:e}]}},t.decorators=[{type:e.NgModule,args:[{imports:[i.CommonModule,r.RouterModule,a.TranslateModule],declarations:[P],exports:[P]}]}],t}();function A(t){if(t)throw new Error("LocalizeRouterModule.forRoot() called twice. Lazy loaded modules should use LocalizeRouterModule.forChild() instead.");return"guarded"}t.ALWAYS_SET_PREFIX=R,t.CACHE_MECHANISM=y,t.CACHE_NAME=v,t.CacheMechanismEnum=d,t.DEFAULT_LANG_FUNCTION=L,t.DummyLocalizeParser=S,t.LOCALIZE_ROUTER_FORROOT_GUARD=p,t.LocalizeParser=C,t.LocalizeRouterConfigLoader=T,t.LocalizeRouterModule=b,t.LocalizeRouterPipe=P,t.LocalizeRouterService=w,t.LocalizeRouterSettings=m,t.ManualParserLoader=I,t.ParserInitializer=O,t.RAW_ROUTES=f,t.USE_CACHED_LANG=g,t.getAppInitializer=x,t.provideForRootGuard=A,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=localize-router.umd.min.js.map