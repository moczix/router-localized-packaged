!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/router"),require("rxjs"),require("rxjs/operators"),require("@ngx-translate/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("localize-router",["exports","@angular/core","@angular/router","rxjs","rxjs/operators","@ngx-translate/core","@angular/common"],t):t((e=e||self)["localize-router"]={},e.ng.core,e.ng.router,e.rxjs,e.rxjs.operators,e.core$1,e.ng.common)}(this,function(e,t,r,n,o,i,a){"use strict";var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function u(e,t){function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function l(e,t){return function(r,n){t(r,n,e)}}function h(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function f(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function p(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(f(arguments[t]));return e}var d,g=new t.InjectionToken("LOCALIZE_ROUTER_FORROOT_GUARD"),y=new t.InjectionToken("RAW_ROUTES");(d=e.CacheMechanism||(e.CacheMechanism={})).LocalStorage="LocalStorage",d.Cookie="Cookie";var v=new t.InjectionToken("USE_CACHED_LANG"),L=new t.InjectionToken("CACHE_MECHANISM"),R=new t.InjectionToken("CACHE_NAME"),m=new t.InjectionToken("DEFAULT_LANG_FUNCTION"),_=new t.InjectionToken("ALWAYS_SET_PREFIX"),j="LOCALIZE_DEFAULT_LANGUAGE",C=function(){function r(t,r,n,o,i){void 0===t&&(t=!0),void 0===r&&(r=!0),void 0===n&&(n=e.CacheMechanism.LocalStorage),void 0===o&&(o=j),void 0===i&&(i=void 0),this.useCachedLang=t,this.alwaysSetPrefix=r,this.cacheMechanism=n,this.cacheName=o,this.defaultLangFunction=i}return r.ngInjectableDef=t.ɵɵdefineInjectable({token:r,factory:function(e){return new(e||r)(t.ɵɵinject(v),t.ɵɵinject(_),t.ɵɵinject(L),t.ɵɵinject(R),t.ɵɵinject(m))},providedIn:null}),r}();t.Injectable;var I=function(){function r(e,t,r){this.translate=e,this.location=t,this.settings=r}return r.prototype.init=function(e){var t;if(this.routes=e,!this.locales||!this.locales.length)return Promise.resolve();var r=this.getLocationLang(),n=this._getBrowserLang();this.settings.defaultLangFunction?this.defaultLang=this.settings.defaultLangFunction(this.locales,this._cachedLang,n):this.defaultLang=this._cachedLang||n||this.locales[0];var o=r||this.defaultLang;this.translate.setDefaultLang(this.defaultLang);var i=[];if(this.settings.alwaysSetPrefix){var a={path:"",redirectTo:this.defaultLang,pathMatch:"full"},s=e.findIndex(function(e){return"**"===e.path});-1!==s&&(this._wildcardRoute=e.splice(s,1)[0]),i=this.routes.splice(0,this.routes.length,a)}else i=this.routes.splice(0,this.routes.length);for(var u=i.length-1;u>=0;u--)i[u].data&&i[u].data.skipRouteLocalization&&(this.routes.push(i[u]),i.splice(u,1));return i&&i.length&&(this.locales.length>1||this.settings.alwaysSetPrefix?(this._languageRoute={children:i},this.routes.unshift(this._languageRoute)):(t=this.routes).unshift.apply(t,p(i))),this._wildcardRoute&&this.settings.alwaysSetPrefix&&this.routes.push(this._wildcardRoute),this.translateRoutes(o).toPromise()},r.prototype.initChildRoutes=function(e){return this._translateRouteTree(e),e},r.prototype.mutateRouterRootRoute=function(e,t,r){var n=this.settings.alwaysSetPrefix||t!==this.defaultLang?t:"",o=this.settings.alwaysSetPrefix||e!==this.defaultLang?e:"",i=r.find(function(e){return e.path===n});i&&(i.path=o)},r.prototype.translateRoutes=function(e){var t=this;return this.setRootLanguage(e),this.translate.use(e).pipe(o.map(function(r){t._translationObject=r,t.currentLang=e,t._languageRoute?(t._translateRouteTree(t._languageRoute.children),t._wildcardRoute&&t._wildcardRoute.redirectTo&&t._translateProperty(t._wildcardRoute,"redirectTo",!0)):t._translateRouteTree(t.routes)}))},r.prototype.setRootLanguage=function(e){this._cachedLang=e,this._languageRoute&&(this._languageRoute.path=this.settings.alwaysSetPrefix||e!==this.defaultLang?e:"")},r.prototype._translateRouteTree=function(e){var t=this;e.forEach(function(e){e.path&&"**"!==e.path&&t._translateProperty(e,"path"),e.redirectTo&&t._translateProperty(e,"redirectTo",!e.redirectTo.indexOf("/")),e.children&&t._translateRouteTree(e.children),e.loadChildren&&e._loadedConfig&&t._translateRouteTree(e._loadedConfig.routes)})},r.prototype._translateProperty=function(e,t,r){var n=e.data=e.data||{};n.localizeRouter||(n.localizeRouter={}),n.localizeRouter[t]||(n.localizeRouter[t]=e[t]);var o=this.translateRoute(n.localizeRouter[t]);e[t]=r?"/"+this.urlPrefix+o:o},Object.defineProperty(r.prototype,"urlPrefix",{get:function(){return this.settings.alwaysSetPrefix||this.currentLang!==this.defaultLang?this.currentLang:""},enumerable:!0,configurable:!0}),r.prototype.translateRoute=function(e){var t=this,r=e.split("?");if(r.length>2)throw"There should be only one query parameter block in the URL";return r[0].split("/").map(function(e){return e.length?t.translateText(e):e}).join("/")+(r.length>1?"?"+r[1]:"")},r.prototype.getLocationLang=function(e){var t=(e||this.location.path()||"").split("#")[0].split("?")[0].split("/");return t.length>1&&-1!==this.locales.indexOf(t[1])?t[1]:t.length&&-1!==this.locales.indexOf(t[0])?t[0]:null},r.prototype._getBrowserLang=function(){return this._returnIfInLocales(this.translate.getBrowserLang())},Object.defineProperty(r.prototype,"_cachedLang",{get:function(){if(this.settings.useCachedLang)return this.settings.cacheMechanism===e.CacheMechanism.LocalStorage?this._cacheWithLocalStorage():this.settings.cacheMechanism===e.CacheMechanism.Cookie?this._cacheWithCookies():void 0},set:function(t){this.settings.useCachedLang&&(this.settings.cacheMechanism===e.CacheMechanism.LocalStorage&&this._cacheWithLocalStorage(t),this.settings.cacheMechanism===e.CacheMechanism.Cookie&&this._cacheWithCookies(t))},enumerable:!0,configurable:!0}),r.prototype._cacheWithLocalStorage=function(e){if("undefined"!=typeof window&&void 0!==window.localStorage)try{return e?void window.localStorage.setItem(this.settings.cacheName,e):this._returnIfInLocales(window.localStorage.getItem(this.settings.cacheName))}catch(e){return}},r.prototype._cacheWithCookies=function(e){if("undefined"!=typeof document&&void 0!==document.cookie)try{var t=encodeURIComponent(this.settings.cacheName);if(e){var r=new Date;return r.setTime(r.getTime()+2592e6),void(document.cookie=t+"="+encodeURIComponent(e)+";expires="+r.toUTCString())}var n=new RegExp("(?:^"+t+"|;\\s*"+t+")=(.*?)(?:;|$)","g").exec(document.cookie);return decodeURIComponent(n[1])}catch(e){return}},r.prototype._returnIfInLocales=function(e){return e&&-1!==this.locales.indexOf(e)?e:null},r.prototype.translateText=function(e){if(!this._translationObject)return e;var t=this.prefix+e,r=this.translate.getParsedResult(this._translationObject,t);return r===t?e:r||e},r=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}([l(0,t.Inject(i.TranslateService)),l(1,t.Inject(a.Location)),l(2,t.Inject(C)),h("design:paramtypes",[i.TranslateService,a.Location,C])],r)}(),w=function(e){function t(t,r,n,o,i){void 0===o&&(o=["en"]),void 0===i&&(i="ROUTES.");var a=e.call(this,t,r,n)||this;return a.locales=o,a.prefix=i||"",a}return u(t,e),t.prototype.load=function(e){var t=this;return new Promise(function(r){t.init(e).then(r)})},t}(I),S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.load=function(e){var t=this;return new Promise(function(r){t.init(e).then(r)})},t}(I),b=function(){function e(e,t,r){this.parser=e,this.settings=t,this.router=r,this.routerEvents=new n.Subject}return e.prototype.init=function(){this.router.resetConfig(this.parser.routes),this.router.events.pipe(o.filter(function(e){return e instanceof r.NavigationStart}),o.pairwise()).subscribe(this._routeChanged())},e.prototype.changeLanguage=function(e){var t=this;if(e!==this.parser.currentLang){var r=this.router.routerState.snapshot.root;this.parser.translateRoutes(e).pipe(o.tap(function(){return t.router.resetConfig(t.parser.routes)})).subscribe(function(){var e=t.traverseSnapshot(r,!0).filter(function(e,t){return!t||e}),n=c({},r.queryParamMap.keys.length?{queryParams:r.queryParams}:{},r.fragment?{fragment:r.fragment}:{});t.router.navigate(e,n)})}},e.prototype.traverseSnapshot=function(e,t){var n=this;if(void 0===t&&(t=!1),t)return e.firstChild?this.settings.alwaysSetPrefix||this.parser.currentLang!==this.parser.defaultLang?p(["/"+this.parser.currentLang],this.traverseSnapshot(e.firstChild.firstChild)):p(this.traverseSnapshot(e.firstChild.firstChild)):[""];var o=this.parseSegmentValue(e),i=e.children.filter(function(e){return e.outlet!==r.PRIMARY_OUTLET}),a=i.reduce(function(e,t){var r;return{outlets:c({},e.outlets,(r={},r[t.outlet]=n.parseSegmentValue(t),r))}},{outlets:{}}),s=e.children.find(function(e){return e.outlet===r.PRIMARY_OUTLET});return p([o],Object.keys(e.params).length?[e.params]:[],i.length?[a]:[],s?this.traverseSnapshot(s):[])},e.prototype.parseSegmentValue=function(e){var t=this;if(e.routeConfig){if("**"===e.routeConfig.path)return this.parser.translateRoute(e.url.filter(function(e){return e.path}).map(function(e){return e.path}).join("/"));if(e.routeConfig.data)return e.routeConfig.data.localizeRouter.path.split("/").map(function(r,n){return 0===r.indexOf(":")?e.url[n].path:t.parser.translateRoute(r)}).join("/")}return""},e.prototype.translateRoute=function(e){var t=this;if(!e)return e;if("string"==typeof e){var r=this.parser.translateRoute(e);return e.indexOf("/")?r:"/"+this.parser.urlPrefix+r}var n=[];return e.forEach(function(e,r){if("string"==typeof e){var o=t.parser.translateRoute(e);r||e.indexOf("/")?n.push(o):n.push("/"+t.parser.urlPrefix+o)}else if(e&&e.outlets){var i={};for(var a in e.outlets)e.outlets.hasOwnProperty(a)&&(i[a]=t.translateRoute(e.outlets[a]));n.push(c({},e,{outlets:i}))}else n.push(e)}),n},e.prototype._routeChanged=function(){var e=this;return function(t){var r=f(t,2),n=r[0],i=r[1],a=e.parser.getLocationLang(n.url)||e.parser.defaultLang,s=e.parser.getLocationLang(i.url)||e.parser.defaultLang;s!==a&&(e.parser.mutateRouterRootRoute(s,a,e.router.config),e.parser.translateRoutes(s).pipe(o.tap(function(){return e.router.resetConfig(e.parser.routes)})).subscribe(function(){e.routerEvents.next(s)}))}},e.ngInjectableDef=t.ɵɵdefineInjectable({token:e,factory:function(n){return new(n||e)(t.ɵɵinject(I),t.ɵɵinject(C),t.ɵɵinject(r.Router))},providedIn:null}),e}();function P(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e!=e&&t!=t)return!0;var r,n,o,i=typeof e;if(i===typeof t&&"object"===i){if(!Array.isArray(e)){if(Array.isArray(t))return!1;for(n in o=Object.create(null),e)if(e.hasOwnProperty(n)){if(!P(e[n],t[n]))return!1;o[n]=!0}for(n in t)if(t.hasOwnProperty(n)&&!(n in o)&&void 0!==t[n])return!1;return!0}if(!Array.isArray(t))return!1;if((r=e.length)===t.length){for(n=0;n<r;n++)if(!P(e[n],t[n]))return!1;return!0}}return!1}t.Injectable;var T=function(){function e(e,t){var r=this;this.localize=e,this._ref=t,this.value="",this.subscription=this.localize.routerEvents.subscribe(function(){r.transform(r.lastKey)})}return e.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},e.prototype.transform=function(e){return e&&0!==e.length&&this.localize.parser.currentLang?P(e,this.lastKey)&&P(this.lastLanguage,this.localize.parser.currentLang)?this.value:(this.lastKey=e,this.lastLanguage=this.localize.parser.currentLang,this.value=this.localize.translateRoute(e),this.lastKey=e,128&this._ref._view.state?this.value:(this._ref.detectChanges(),this.value)):e},e.ngPipeDef=t.ɵɵdefinePipe({name:"localize",type:e,factory:function(r){return new(r||e)(t.ɵɵdirectiveInject(b),t.ɵɵinjectPipeChangeDetectorRef())},pure:!1}),e}();t.Pipe;var O=function(e){function n(t,r,n){var o=e.call(this,r,n)||this;return o.localize=t,o}return u(n,e),n.prototype.load=function(t){var n=this;return e.prototype.load.call(this,t).then(function(e){return{moduleType:e.moduleType,create:function(t){var o=e.create(t),i=o.injector.get.bind(o.injector);return o.injector.get=function(e,t){var o=i(e,t);return e===r.ROUTES?n.localize.initChildRoutes([].concat.apply([],p(o))):o},o}}})},n.ngInjectableDef=t.ɵɵdefineInjectable({token:n,factory:function(e){return new(e||n)(t.ɵɵinject(t.forwardRef(function(){return I})),t.ɵɵinject(t.Compiler),t.ɵɵinject(t.SystemJsNgModuleLoaderConfig,8))},providedIn:null}),n}(t.SystemJsNgModuleLoader);t.Injectable;var M=function(){function e(e){this.injector=e}return e.prototype.appInitializer=function(){var e=this,t=this.parser.load(this.routes);return t.then(function(){e.injector.get(b).init()}),t},e.prototype.generateInitializer=function(e,t){return this.parser=e,this.routes=t.reduce(function(e,t){return e.concat(t)}),this.appInitializer},e.ngInjectableDef=t.ɵɵdefineInjectable({token:e,factory:function(r){return new(r||e)(t.ɵɵinject(t.Injector))},providedIn:null}),e}();function x(e,t,r){return e.generateInitializer(t,r).bind(e)}t.Injectable;var A=function(){function e(){}return e.forRoot=function(r,n){return void 0===n&&(n={}),{ngModule:e,providers:[{provide:g,useFactory:E,deps:[[e,new t.Optional,new t.SkipSelf]]},{provide:v,useValue:n.useCachedLang},{provide:_,useValue:n.alwaysSetPrefix},{provide:R,useValue:n.cacheName},{provide:L,useValue:n.cacheMechanism},{provide:m,useValue:n.defaultLangFunction},C,n.parser||{provide:I,useClass:S},{provide:y,multi:!0,useValue:r},b,M,{provide:t.NgModuleFactoryLoader,useClass:O},{provide:t.APP_INITIALIZER,multi:!0,useFactory:x,deps:[M,I,y]}]}},e.forChild=function(t){return{ngModule:e,providers:[{provide:y,multi:!0,useValue:t}]}},e.ngModuleDef=t.ɵɵdefineNgModule({type:e}),e.ngInjectorDef=t.ɵɵdefineInjector({factory:function(t){return new(t||e)},imports:[[a.CommonModule,r.RouterModule,i.TranslateModule]]}),e}();function E(e){if(e)throw new Error("LocalizeRouterModule.forRoot() called twice. Lazy loaded modules should use LocalizeRouterModule.forChild() instead.");return"guarded"}a.CommonModule,r.RouterModule,i.TranslateModule,t.NgModule,a.CommonModule,r.RouterModule,i.TranslateModule,e.ALWAYS_SET_PREFIX=_,e.CACHE_MECHANISM=L,e.CACHE_NAME=R,e.DEFAULT_LANG_FUNCTION=m,e.DummyLocalizeParser=S,e.LOCALIZE_ROUTER_FORROOT_GUARD=g,e.LocalizeParser=I,e.LocalizeRouterConfigLoader=O,e.LocalizeRouterModule=A,e.LocalizeRouterPipe=T,e.LocalizeRouterService=b,e.LocalizeRouterSettings=C,e.ManualParserLoader=w,e.ParserInitializer=M,e.RAW_ROUTES=y,e.USE_CACHED_LANG=v,e.getAppInitializer=x,e.provideForRootGuard=E,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=localize-router.umd.min.js.map